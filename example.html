<!DOCTYPE html>
<html><!--STATUS OK--><head><meta name="referrer" content="always" /><meta charset='utf-8' /><meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
<head>                 
<title>test</title>
<link rel="stylesheet" type="text/css" href="legomini/css/legomini.min.css" />
<link rel="stylesheet" type="text/css" href="static/style.css" />
</head>

<body style="padding: 0px; margin: 0px;" class="main">
<div id="container" style="display: none; z-index: 10000">
    <page>
        <topbar>
            主页
            <a href="javascript:" slot="right" style="display: inline-block; height: 45px; width: 45px; text-align: center; color: #fff; text-decoration: none;" v-actions="{'haha': '123', 'fd': ''}">操作</a>
        </topbar>

        <div style="background: #28304E;;">
            <search-bar ref="bar" @click="search()" :readonly="true" />
        </div>

        <list :options="{
            source: '/data/test.json',
            dataFormatter: format,
            rowFormatter: rowRender,
            pulldown2refresh: true,
            pullup2load: true
        }">
            <div slot="header" style="height: 100px; background: blue;"></div>
        </list>
        <div style="height: 50px; background: black; color: #fff;" >我是底部</div>
    </page>
</div>

<style>
.inner{
    margin-top: -30px;
}

.row-name{
    font-family: PingFangSC-Semibold;
font-size: 14px;
color: #6281C2;
letter-spacing: 0;
line-height: 24px;
}

.row-content{
    font-family: PingFangSC-Regular;
font-size: 12px;
color: #555555;
letter-spacing: 0;
line-height: 20px;
}

.row-black{
    font-family: PingFangSC-Semibold;
font-size: 14px;
color: #101010;
letter-spacing: 0;
line-height: 24px;
}
</style>
<script>

window.PointerEvent = void 0;
// require.async(['fastclick'], function(FastClick){
//     FastClick(document.body);
// });
// 
require.async('legomini/js/rem');
window.onerror = function(a, b){
    alert(a);
    alert(b);
};

require.async(['vue', 'vmui/page', 'vmui/scroll', 'vmui/factory', 'vmui/topbar', 'router', 'vmui/toast', 'vmui/actionsheet', 'vmui/list', 'vmui/searchbar', 'vmui/search', 'vmui/actions', 'vmui/alert'], function(Vue, PageView, Scroll, Factory, TopBar, Router, Toast, ActionSheet, List,  SearchBar, Search, Actions, Alert){

    ActionSheet({
        '123': alert('123')
    })

    Toast('fdjskfs');

    Alert('fdjkfsf');

    var stack = {}, hasHash = !!location.hash;
    var router = new Router({
        '': function(){
            document.getElementById('container').style.display = 'block';

            return new Vue({
                el: '#container',
                components: {
                    Scroll: Scroll,
                    Page: PageView,
                    Topbar: TopBar,
                    List: List,
                    SearchBar: SearchBar,
                    Search: Search
                },

                directives: {
                    Actions: Actions
                },

                data:{
                    searchView: null,
                    header: '3jkfdk',
                    dropdown: false
                },

                methods: {
                    openDropDown: function(){
                        this.dropdown = true;
                    },

                    format: function(data){
                        return data.data;
                    },

                    rowFormatter: function(data){
                        return data.name
                    },

                    rowRender: function(data){
                        return '<div style="padding: 10px 0px;"><p class="row-name">' + data.name + ' <span class="row-black">（一期）</span></p>' + '<p class="row-content">' + data.content + '</p></div>'  
                    },

                    openActions: function(){
                        ActionSheet({
                            'xx': function(){
                                location.href = 'tel:1233';
                            },
                            'yy': function(){
                                location.href = 'tel:1233';
                            }
                        });
                    },

                    renderHeader: function(){
                        this.header = Math.random();
                    },

                    input: function(){
                        this.$refs.list.setParams({name: 1});
                        this.$refs.list.refresh(false);
                    },

                    submit: function(){
                        alert(1233);
                    },
                    share: function(){

                    },

                    log(v){
                        console.log(v)
                    },

                    search: function(){
                        var self = this;

                        require.async('vmui/search', function(SearchView){
                            if(!self.searchView){
                                self.searchView = Factory({
                                    components: {
                                        Search: SearchView
                                    },

                                    template: '<search ref="search" :visible="false" :fx="true" :list-options="{\
                                        source: \'/data/search.json\',\
                                        params: {\
                                            name: 123\
                                        },\
                                        pullup2load: true,\
                                        dataFormatter: format,\
                                        rowFormatter: rowRender\
                                    }" @select="select"/>',
                                    methods: {
                                        select: function(item){
                                            self.searchView.close();
                                            self.$refs.bar.value = item.content;
                                        },

                                        format: function(data){
                                            return data.data;
                                        },

                                        rowRender: function(data){
                                            return '<div style="padding: 10px 0px;"><p class="row-name">' + data.name + ' <span class="row-black">（一期）</span></p>' + '<p class="row-content">' + data.content + '</p></div>'  
                                        }
                                    }
                                }).$refs.search;
                            }

                            self.searchView.open();
                        });
                    },

                    alert: function(item){
                        console.log(item);
                    }
                }
            }); 
        },

        'news': function(){
            return Factory({
                template: __inline('static/1.tpl'),
                data: {
                    title: '第2个页面',
                    url: 'adds'
                },
                components: {
                    Page: PageView,
                    Topbar: TopBar,
                    Scroll: Scroll
                },

                methods: {
                    submit: function(){
                        Toast.success('提交成功', 3000);
                        history.back();
                    }
                }
            });  
        },

        'adds': function(){
            return Factory({
                template: __inline('static/1.tpl'),
                data: {
                    title: '第三个页面',
                    url: 'ddd'
                },
                components: {
                    Page: PageView,
                    Topbar: TopBar
                }
            });  
        }
    }, {
        beforeCall: function(to, from){
            if(stack[to]){
                if(stack[from]){
                    stack[from].$refs.page.close();
                    delete stack[from];
                    return false;
                }
            }

            return true;
        }
    });

    router.on('call', function(vm, info){
        stack[info ? info[0] : ''] = vm;
    });
});
</script>
</body>
</html>